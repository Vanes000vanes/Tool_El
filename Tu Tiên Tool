// ==UserScript==
// @name         âš”ï¸ ã€TiÃªn Hiá»‡pã€‘HoÃ ng HoÃ ng BÃ­ Tá»‹ch v2.1 
// @namespace    http://tampermonkey.net/
// @version      2.1
// @description  HWANG IMMORTAL EDITION - PhÃ­m M
// @author       Hwang
// @match        *://eldorado-asako.com/game*
// @match        *://h5.eldorado-asako.com/game*
//@icon          https://i.pinimg.com/736x/29/a0/31/29a0312344914386881165a62e68775e.jpg
// @grant        none
// ==/UserScript==



(function() {
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸŒŒ ã€Tháº¿ Giá»›i TiÃªn Hiá»‡pã€‘Khá»Ÿi táº¡o script
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    if (window.__HWANG_IMMORTAL_SCRIPT) {
        console.log("âš”ï¸ ã€HoÃ ng HoÃ ng Lá»‡nhã€‘Script Ä‘Ã£ hiá»ƒn hiá»‡n táº¡i tháº¿ giá»›i nÃ y!");
        return;
    }
    window.__HWANG_IMMORTAL_SCRIPT = true;

    // TiÃªn nhÃ¢n Ä‘á»™c thoáº¡i
    const IMMORTAL_DIALOGUES = [
        "Ta lÃ  tu tiÃªn Ä‘áº¡i nÄƒng, chu du váº¡n giá»›i...",
        "Game cá»n con, hÃ¡ cÃ³ thá»ƒ cáº£n trá»Ÿ Ä‘áº¡o tÃ¢m cá»§a ta?",
        "Cáº£nh giá»›i Ä‘á»™t phÃ¡! Ta Ä‘Ã£ vÃ´ Ä‘á»‹ch!",
        "HoÃ ng HoÃ ng PhÃ¡p Táº¯c, cáº¥m chá»‰ táº¥t cáº£!",
        "ÄÃ¢y... Ä‘Ã¢y lÃ  HoÃ ng HoÃ ng BÃ­ Tá»‹ch trong truyá»n thuyáº¿t!",
        "Sá»©c máº¡nh cá»§a ta Ä‘Ã£ vÆ°á»£t xa trÃ² chÆ¡i nÃ y!",
        "Tu tiÃªn lá»™ váº¡n dáº·m, ta Ä‘Ã£ Ä‘áº¿n Ä‘á»‰nh cao!",
        "Há»­? ÄÃ¢y lÃ  chÆ° thiÃªn trÃ² chÆ¡i? QuÃ¡ yáº¿u á»›t...",
        "NhÃ¢n danh HoÃ ng HoÃ ng, nghiá»n nÃ¡t tháº¿ giá»›i nÃ y!",
        "ThiÃªn Ä‘á»‹a há»£p nháº¥t, váº¡n váº­t quy tÃ¢m, duy ngÃ£ Ä‘á»™c tÃ´n!"
    ];

    function sayImmotalDialogue() {
        const msg = IMMORTAL_DIALOGUES[Math.floor(Math.random() * IMMORTAL_DIALOGUES.length)];
        console.log(`ğŸ§˜ ã€HoÃ ng HoÃ ng Máº­t Ngá»¯ã€‘${msg}`);
    }

    console.log("%c â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—", "color: #FFFFFF; font-weight: bold");
    console.log("%c â•‘     âš”ï¸ ã€TiÃªn NhÃ¢n BÃ­ Tá»‹chã€‘Há»‡ Thá»‘ng Tu TiÃªn Tá»‘i ThÆ°á»£ng v2.1  â•‘", "color: #FFFFFF; font-weight: bold");
    console.log("%c â•‘               HWANG IMMORTAL EDITION (Dá»‹ch)           â•‘", "color: #CCCCCC; font-weight: bold");
    console.log("%c â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•", "color: #FFFFFF; font-weight: bold");
    sayImmotalDialogue();

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ”§ Quáº£n lÃ½ tráº¡ng thÃ¡i cá»‘t lÃµi
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    let cloudHackInterval = null;
    let _origCloudGarden = null;
    let _origCloudVars = null;

    const _setInterval = window.setInterval;
    const _setTimeout = window.setTimeout;

    // [Sá»¬A Lá»–I] LÆ°u láº¡i hÃ m alert/confirm gá»‘c trÆ°á»›c khi vÃ´ hiá»‡u hÃ³a
    const _originalAlert = window.alert;
    const _originalConfirm = window.confirm;
    window.alert = null; // VÃ´ hiá»‡u hÃ³a alert cá»§a game

    const originalTimers = {
        TIMER_INTERVAL: window.TIMER_INTERVAL,
        EFFECT_INTERVAL: window.EFFECT_INTERVAL,
        BOSS_TIMER_INTERVAL: window.BOSS_TIMER_INTERVAL,
        CLOUD_GARDEN_TIMER_INTERVAL: window.CLOUD_GARDEN_TIMER_INTERVAL
    };

    const fastTimers = {
        TIMER_INTERVAL: 10,
        EFFECT_INTERVAL: 10,
        BOSS_TIMER_INTERVAL: 10,
        CLOUD_GARDEN_TIMER_INTERVAL: 10
    };

    window.__HACK_STATE = window.__HACK_STATE || {};
    window.__HACK_STATE.enabled = false;
    window.__HACK_STATE.timers = fastTimers;
    window.__HACK_STATE.stats = {
        unitsBuffed: 0,
        totalDamage: 0,
        sessionTime: 0
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // âš¡ Há»‡ thá»‘ng Hook háº¹n giá»
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    if (!window.__HWANG_TIMERS_HOOKED) {
        window.__HWANG_TIMERS_HOOKED = true;

        window.setInterval = function(fn, delay, ...args) {
            const state = window.__HACK_STATE;
            if (state.enabled) {
                for (const name in state.timers) {
                    try {
                        if (delay === window[name] || (window.glo && delay === window.glo[name])) {
                            delay = state.timers[name];
                            break;
                        }
                    } catch(e) {}
                }
            }
            return _setInterval(fn, delay, ...args);
        };

        window.setTimeout = function(fn, delay, ...args) {
            const state = window.__HACK_STATE;
            if (state.enabled) {
                for (const name in state.timers) {
                    try {
                        if (delay === window[name] || (window.glo && delay === window.glo[name])) {
                            delay = state.timers[name];
                            break;
                        }
                    } catch(e) {}
                }
            }
            return _setTimeout(fn, delay, ...args);
        };
    }

    if (window.glo?.fun?.show_s_error_network) {
        window.glo.fun.show_s_error_network = () => {};
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ¨ ã€Háº¯c Báº¡ch UIã€‘Há»‡ thá»‘ng Giao diá»‡n - Phong cÃ¡ch Äen Tráº¯ng
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function addStyles() {
        if (document.querySelector("#hwangImmortalStyles")) return;

        const style = document.createElement("style");
        style.id = "hwangImmortalStyles";
        style.textContent = `
            /* ===== Báº£ng Ä‘iá»u khiá»ƒn chÃ­nh ===== */
            #hwangMainPanel {
                position: fixed;
                bottom: 20px;
                left: 20px;
                width: 320px;
                background: #111111;
                border: 2px solid #555555;
                border-radius: 10px;
                box-shadow:
                    0 0 20px rgba(0, 0, 0, 0.5),
                    0 0 30px rgba(255, 255, 255, 0.05),
                    inset 0 0 10px rgba(255, 255, 255, 0.05);
                z-index: 100000;
                font-family: 'Microsoft YaHei', 'SimHei', sans-serif;
                color: #EEEEEE;
                user-select: none;
                overflow: hidden;

                /* [Má»šI] ThÃªm Animation */
                opacity: 1;
                transform: translateX(0);
                transition: opacity 0.4s ease, transform 0.4s ease;
            }

            /* [Má»šI] Tráº¡ng thÃ¡i áº©n cho phÃ­m M */
            #hwangMainPanel.hwang-hidden {
                opacity: 0;
                transform: translateX(-100px);
                pointer-events: none;
            }

            @keyframes hwangPanelBreathe {
                0%, 100% { box-shadow: 0 0 20px rgba(0, 0, 0, 0.5), 0 0 30px rgba(255, 255, 255, 0.05), inset 0 0 10px rgba(255, 255, 255, 0.05); }
                50% { box-shadow: 0 0 10px rgba(0, 0, 0, 0.4), 0 0 20px rgba(255, 255, 255, 0.02), inset 0 0 5px rgba(255, 255, 255, 0.02); }
            }

            /* Thanh tiÃªu Ä‘á» */
            #hwangTitle {
                background: #222222;
                padding: 12px 15px;
                border-bottom: 1px solid #555555;
                font-size: 16px;
                font-weight: bold;
                text-align: center;
                letter-spacing: 1px;
                text-shadow: 0 0 5px #EEEEEE;
                cursor: move;
            }

            #hwangTitle:hover { text-shadow: 0 0 10px #FFFFFF; }

            /* Khu vá»±c ná»™i dung */
            #hwangContent {
                padding: 15px;
                max-height: 400px;
                overflow-y: auto;
            }

            /* ===== Kiá»ƒu nÃºt báº¥m ===== */
            .hwang-btn {
                width: 100%;
                padding: 12px;
                margin: 8px 0;
                background: #222222;
                border: 1px solid #555555;
                border-radius: 6px;
                color: #EEEEEE;
                font-size: 14px;
                font-weight: bold;
                cursor: pointer;
                transition: all 0.3s ease;
                text-shadow: none;
                letter-spacing: 1px;
            }

            .hwang-btn:hover {
                background: #333333;
                box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
                color: #FFFFFF;
                transform: translateY(-2px);
            }

            .hwang-btn:active {
                transform: translateY(0);
                box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.2);
            }

            .hwang-btn.active {
                background: #FFFFFF;
                color: #000000;
                box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
                text-shadow: none;
            }

            /* ÄÃ¨n bÃ¡o tráº¡ng thÃ¡i */
            .hwang-status {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 10px;
                background: rgba(255, 255, 255, 0.02);
                border: 1px solid #444444;
                border-radius: 6px;
                margin: 8px 0;
                font-size: 12px;
            }

            .hwang-status-dot {
                width: 12px;
                height: 12px;
                border-radius: 50%;
                background: #555;
                box-shadow: 0 0 5px #555;
            }

            .hwang-status-dot.on {
                background: #FFFFFF;
                box-shadow: 0 0 10px #FFFFFF;
                animation: hwangDotPulse 1s ease-in-out infinite;
            }

            @keyframes hwangDotPulse {
                0%, 100% { box-shadow: 0 0 10px #FFFFFF; }
                50% { box-shadow: 0 0 20px #FFFFFF; }
            }

            /* ThÃ´ng tin thá»‘ng kÃª */
            .hwang-stats {
                background: rgba(0, 0, 0, 0.3);
                border: 1px solid #444444;
                border-radius: 6px;
                padding: 10px;
                margin: 8px 0;
                font-size: 12px;
                line-height: 1.6;
            }

            .hwang-stats-item {
                display: flex;
                justify-content: space-between;
                margin: 4px 0;
            }

            .hwang-stats-label { color: #CCCCCC; }
            .hwang-stats-value {
                color: #FFFFFF;
                font-weight: bold;
                text-shadow: 0 0 5px #FFFFFF;
            }

            /* Thanh cuá»™n */
            #hwangContent::-webkit-scrollbar {
                width: 8px;
            }

            #hwangContent::-webkit-scrollbar-track {
                background: rgba(0, 0, 0, 0.3);
                border-radius: 10px;
            }

            #hwangContent::-webkit-scrollbar-thumb {
                background: #888888;
                border-radius: 10px;
                box-shadow: 0 0 5px rgba(255, 255, 255, 0.1);
            }

            #hwangContent::-webkit-scrollbar-thumb:hover {
                background: #AAAAAA;
            }

            /* Dáº£i phÃ¢n cÃ¡ch */
            .hwang-divider {
                height: 1px;
                background: linear-gradient(90deg, transparent 0%, #555 50%, transparent 100%);
                margin: 12px 0;
            }

            /* Tháº» tag */
            .hwang-tag {
                display: inline-block;
                padding: 4px 8px;
                background: rgba(255, 255, 255, 0.05);
                border: 1px solid #555;
                border-radius: 4px;
                font-size: 11px;
                margin-right: 4px;
                margin-bottom: 4px;
                color: #AAAAAA;
            }

            /* NÃºt Ä‘Ã³ng */
            #hwangClose {
                position: absolute;
                top: 8px;
                right: 8px;
                width: 24px;
                height: 24px;
                background: transparent;
                border: none;
                color: #AAAAAA;
                font-size: 20px;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            #hwangClose:hover {
                transform: rotate(90deg);
                color: #FFFFFF;
                text-shadow: 0 0 10px #FFFFFF;
            }

            /* NÃºt thu nhá» */
            #hwangMinimize {
                position: absolute;
                top: 8px;
                right: 35px;
                width: 24px;
                height: 24px;
                background: transparent;
                border: none;
                color: #AAAAAA;
                font-size: 16px;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            #hwangMinimize:hover {
                color: #FFFFFF;
                text-shadow: 0 0 10px #FFFFFF;
            }

            /* Tráº¡ng thÃ¡i thu nhá» */
            #hwangMainPanel.minimized #hwangContent {
                display: none;
            }

            #hwangMainPanel.minimized #hwangTitle::after {
                content: " [Thu nhá»]";
            }

            /* Kiá»ƒu nÃºt chÃ­nh Ä‘áº·c biá»‡t */
            #hwangToggleBtn {
                font-size: 16px;
                padding: 15px;
                background: #333333 !important;
                border: 2px solid #666666 !important;
            }

            #hwangToggleBtn:hover {
                background: #444444 !important;
                box-shadow: 0 0 20px rgba(255, 255, 255, 0.2) !important;
                border-color: #999999 !important;
            }

            #hwangToggleBtn.active {
                background: #FFFFFF !important;
                border-color: #FFFFFF !important;
                color: #000000 !important;
                box-shadow: 0 0 30px rgba(255, 255, 255, 0.7) !important;
                animation: hwangPulse 0.6s ease-in-out;
            }

            @keyframes hwangPulse {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.05); }
            }

            /* Responsive cho di Ä‘á»™ng */
            @media (max-width: 480px) {
                #hwangMainPanel {
                    width: 280px;
                    bottom: 10px;
                    left: 10px;
                }
                .hwang-btn { padding: 10px; font-size: 12px; }
            }
        `;
        document.head.appendChild(style);
        console.log("ğŸ¨ ã€Háº¯c Báº¡ch UIã€‘Há»‡ thá»‘ng giao diá»‡n Ä‘Ã£ táº£i!");
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ” Há»‡ thá»‘ng dÃ² tÃ¬m GUI
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function isRealGui() {
        const hasCanvas = document.querySelector("canvas");
        const hasGameVars = typeof OUR_TEAM_ARRAY !== "undefined" || typeof S_CLOUD_GARDEN !== "undefined";
        const hasGameContainer = document.querySelector(".game-container");
        return document.body && (hasCanvas || hasGameVars || hasGameContainer);
    }

    function waitForRealGui(callback) {
        if (isRealGui()) {
            console.log("âœ… ã€Tháº¿ Giá»›i Gameã€‘PhÃ¡t hiá»‡n giao diá»‡n game tháº­t!");
            callback();
        } else {
            setTimeout(() => waitForRealGui(callback), 100);
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ’ª Há»‡ thá»‘ng cÆ°á»ng hÃ³a Ä‘Æ¡n vá»‹ (Báº£n SIÃŠU Cáº¤P)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    const originalStats = new WeakMap();

    function applyBuff(unit) {
        if (!unit || typeof unit !== "object") return;

        if (!originalStats.has(unit)) {
            try {
                originalStats.set(unit, { ...unit });
            } catch(e) {}
        }

        try {
            // HP -
                    unit.hp = 999999999;
                    unit.max_hp = 999999999;
                    unit.full_hp = 9999999;

                    // SÃT THÆ¯Æ NG -
                    unit.attack_power = 999999999999999999999999999999999999999999999999999999999999999999999999999999999999999;
                    unit.ori_attack_power = 99999999999999999999999999999999999999999999999999999999999999999999999999999999;

                    // Tá»‘c Ä‘á»™ Táº¤N CÃ”NG -
                    unit.attack_speed = -99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999;
                    unit.ori_attack_speed = -999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999;
                    unit.attack_speed_tick_count = -99999999999999999999999999999999999999;

                    // Táº¦M ÄÃNH -
                    unit.attack_len = 99999;

                    // Tá»‘c Ä‘á»™ Báº®N -
                    unit.fire_frame_num = 1;
                    unit.fire_frame_cur = 1;
                    unit.wait_frame_cur = 1;
                    unit.ch_time = 0.1;

                    // DI CHUYá»‚N -
                    unit.move_speed = 999999;
                    unit.ori_move_speed = 999999;

                    // Cáº¤P Äá»˜ -
                    unit.star =9999999999;
                    unit.max_level = 9999999999999;

                    // GIÃ Ráºº
                    unit.need_mineral = 1;

                    // Báº¤T Tá»¬
                    unit.is_strength = 9999;
                    unit.is_invincible = 1;
                    unit.immortal = 1;
                    unit.god_mode = 1;

            window.__HACK_STATE.stats.unitsBuffed++;
        } catch(e) {
            console.log("âŒ CÆ°á»ng hÃ³a Ä‘Æ¡n vá»‹ tháº¥t báº¡i:", e);
        }
    }

    function restoreUnit(unit) {
        if (!unit || typeof unit !== "object") return;
        if (!originalStats.has(unit)) return;

        try {
            const original = originalStats.get(unit);
            for (const key in original) {
                unit[key] = original[key];
            }
        } catch(e) {
            console.log("âŒ KhÃ´i phá»¥c Ä‘Æ¡n vá»‹ tháº¥t báº¡i:", e);
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // â˜ï¸ CÃ´ng nghá»‡ Háº¯c Ãm: VÃ¢n Hoa ViÃªn
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function startCloudHack() {
        if (_origCloudGarden === null && typeof S_CLOUD_GARDEN !== "undefined") {
            _origCloudGarden = {
                notice_timer: S_CLOUD_GARDEN.notice_timer,
                score_correction: S_CLOUD_GARDEN.score_correction,
                dragon_damage_timer: S_CLOUD_GARDEN.dragon_damage_timer,
                spawn_timer: S_CLOUD_GARDEN.spawn_timer
            };
        }

        if (_origCloudVars === null) {
            _origCloudVars = {
                CLOUD_GARDEN_SPEED: (typeof CLOUD_GARDEN_SPEED !== "undefined") ? CLOUD_GARDEN_SPEED : undefined,
                CLOUD_GARDEN_DAMAGE: (typeof CLOUD_GARDEN_DAMAGE !== "undefined") ? CLOUD_GARDEN_DAMAGE : undefined
            };
        }

        if (cloudHackInterval) clearInterval(cloudHackInterval);

        cloudHackInterval = setInterval(() => {
            try {
                if (typeof S_CLOUD_GARDEN !== "undefined" && S_CLOUD_GARDEN) {
                    S_CLOUD_GARDEN.notice_timer = 1;
                    S_CLOUD_GARDEN.score_correction = 999;
                    S_CLOUD_GARDEN.dragon_damage_timer = 1;
                    S_CLOUD_GARDEN.spawn_timer = 1;
                }
                if (typeof CLOUD_GARDEN_SPEED !== "undefined") CLOUD_GARDEN_SPEED = 50;
                if (typeof CLOUD_GARDEN_DAMAGE !== "undefined") CLOUD_GARDEN_DAMAGE = 9999;
            } catch(err) {}
        }, 100);

        console.log("â˜ï¸ ã€VÃ¢n Hoa ViÃªnã€‘CÃ´ng nghá»‡ Háº¯c Ãm Ä‘Ã£ khá»Ÿi Ä‘á»™ng!");
    }

    function stopCloudHack() {
        if (cloudHackInterval) {
            clearInterval(cloudHackInterval);
            cloudHackInterval = null;
        }

        if (_origCloudGarden && typeof S_CLOUD_GARDEN !== "undefined") {
            try {
                if (_origCloudGarden.notice_timer !== undefined) S_CLOUD_GARDEN.notice_timer = _origCloudGarden.notice_timer;
                if (_origCloudGarden.score_correction !== undefined) S_CLOUD_GARDEN.score_correction = _origCloudGarden.score_correction;
                if (_origCloudGarden.dragon_damage_timer !== undefined) S_CLOUD_GARDEN.dragon_damage_timer = _origCloudGarden.dragon_damage_timer;
                if (_origCloudGarden.spawn_timer !== undefined) S_CLOUD_GARDEN.spawn_timer = _origCloudGarden.spawn_timer;
            } catch(e) {}
        }

        console.log("â˜ï¸ ã€VÃ¢n Hoa ViÃªnã€‘CÃ´ng nghá»‡ Háº¯c Ãm Ä‘Ã£ táº¯t");
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ® Táº¡o báº£ng Ä‘iá»u khiá»ƒn chÃ­nh
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function createMainPanel() {
        if (document.getElementById("hwangMainPanel")) return;

        const panel = document.createElement("div");
        panel.id = "hwangMainPanel";

        panel.innerHTML = `
            <div id="hwangTitle">
                âš”ï¸ ã€HoÃ ng HoÃ ng BÃ­ Tá»‹chã€‘v2.1
                <button id="hwangMinimize" title="Thu nhá»">â”</button>
                <button id="hwangClose" title="ÄÃ³ng">âœ•</button>
            </div>
            <div id="hwangContent">
                <button id="hwangToggleBtn" class="hwang-btn">
                    âš¡ Khá»Ÿi Ä‘á»™ng Há»‡ Thá»‘ng Tu TiÃªn
                </button>

                <div class="hwang-divider"></div>

                <div class="hwang-status">
                    <span>ğŸ”§ Tráº¡ng thÃ¡i há»‡ thá»‘ng</span>
                    <div class="hwang-status-dot"></div>
                </div>

                <div class="hwang-stats">
                    <div class="hwang-stats-item">
                        <span class="hwang-stats-label">ğŸ’ª ÄÆ¡n vá»‹ cÆ°á»ng hÃ³a:</span>
                        <span class="hwang-stats-value" id="statUnits">0</span>
                    </div>
                    <div class="hwang-stats-item">
                        <span class="hwang-stats-label">âš¡ Thá»i gian cháº¡y:</span>
                        <span class="hwang-stats-value" id="statTime">0s</span>
                    </div>
                    <div class="hwang-stats-item">
                        <span class="hwang-stats-label">ğŸ‘‘ Cáº¥p Ä‘á»™ quyá»n háº¡n:</span>
                        <span class="hwang-stats-value">HWANG IMMORTAL</span>
                    </div>
                </div>

                <div class="hwang-divider"></div>

                <button id="hwangCloudBtn" class="hwang-btn">
                    â˜ï¸ TÄƒng tá»‘c VÃ¢n Hoa ViÃªn
                </button>

                <button id="hwangStatsBtn" class="hwang-btn">
                    ğŸ“Š Xem thá»‘ng kÃª chi tiáº¿t
                </button>

                <button id="hwangResetBtn" class="hwang-btn">
                    ğŸ”„ Äáº·t láº¡i Tráº¡ng thÃ¡i
                </button>

                <div class="hwang-divider"></div>

                <div style="text-align: center; font-size: 11px; color: #888; padding: 10px 0;">
                    <div>ğŸ‘‘ Chá»§ nhÃ¢n: <span style="color: #CCCCCC;">Hwangçš‡</span></div>
                    <div><span class="hwang-tag">v2.1</span><span class="hwang-tag">Ultimate</span><span class="hwang-tag">TiÃªn Hiá»‡p</span></div>
                </div>
            </div>
        `;

        document.body.appendChild(panel);
        console.log("ğŸ® ã€Báº£ng Ä‘iá»u khiá»ƒnã€‘Ä‘Ã£ Ä‘Æ°á»£c táº¡o!");

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ¯ Há»‡ thá»‘ng xá»­ lÃ½ sá»± kiá»‡n
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        let running = window.__HACK_STATE.enabled;
        let buffInterval = null;
        let statsInterval = null;
        let isDragging = false;
        let dragOffsetX = 0, dragOffsetY = 0;

        const titleEl = document.getElementById("hwangTitle");
        const toggleBtn = document.getElementById("hwangToggleBtn");
        const cloudBtn = document.getElementById("hwangCloudBtn");
        const statsBtn = document.getElementById("hwangStatsBtn");
        const resetBtn = document.getElementById("hwangResetBtn");
        const closeBtn = document.getElementById("hwangClose");
        const minimizeBtn = document.getElementById("hwangMinimize");
        const statusDot = panel.querySelector(".hwang-status-dot");

        // NÃºt báº­t/táº¯t chÃ­nh
        toggleBtn.addEventListener("click", () => {
            if (!running) {
                window.__HACK_STATE.enabled = true;
                running = true;

                toggleBtn.textContent = "âœ‹ Dá»«ng Tu TiÃªn";
                toggleBtn.classList.add("active");
                statusDot.classList.add("on");

                buffInterval = setInterval(() => {
                    if (typeof OUR_TEAM_ARRAY !== "undefined" && Array.isArray(OUR_TEAM_ARRAY)) {
                        for (let i = 0; i < OUR_TEAM_ARRAY.length; i++) {
                            applyBuff(OUR_TEAM_ARRAY[i]);
                        }
                    }
                }, 200);

                try {
                    startCloudHack();
                } catch(e) {}

                sayImmotalDialogue();
                console.log("ğŸŒŸ ã€Cháº¿ Ä‘á»™ Tu TiÃªnã€‘Ä‘Ã£ khá»Ÿi Ä‘á»™ng!");
            } else {
                window.__HACK_STATE.enabled = false;
                running = false;

                toggleBtn.textContent = "âš¡ Khá»Ÿi Ä‘á»™ng Há»‡ Thá»‘ng Tu TiÃªn";
                toggleBtn.classList.remove("active");
                statusDot.classList.remove("on");

                if (buffInterval) {
                    clearInterval(buffInterval);
                    buffInterval = null;
                }

                if (typeof OUR_TEAM_ARRAY !== "undefined" && Array.isArray(OUR_TEAM_ARRAY)) {
                    for (let i = 0; i < OUR_TEAM_ARRAY.length; i++) {
                        restoreUnit(OUR_TEAM_ARRAY[i]);
                    }
                }

                try {
                    stopCloudHack();
                } catch(e) {}

                console.log("ğŸŒ™ ã€Cháº¿ Ä‘á»™ Tu TiÃªnã€‘Ä‘Ã£ táº¯t");
            }
        });

        // NÃºt VÃ¢n Hoa ViÃªn
        cloudBtn.addEventListener("click", () => {
            if (running) {
                _originalAlert("â˜ï¸ TÄƒng tá»‘c VÃ¢n Hoa ViÃªn Ä‘Ã£ cháº¡y cÃ¹ng há»‡ thá»‘ng chÃ­nh!");
            } else {
                startCloudHack();
                _originalAlert("â˜ï¸ TÄƒng tá»‘c VÃ¢n Hoa ViÃªn Ä‘Ã£ khá»Ÿi Ä‘á»™ng (táº¡m thá»i)!");
                setTimeout(stopCloudHack, 10000);
            }
        });

        // NÃºt thá»‘ng kÃª
        statsBtn.addEventListener("click", () => {
            const stats = window.__HACK_STATE.stats;
            const msg = `
ğŸ“Š ã€Thá»‘ng KÃª Tu TiÃªnã€‘
â”â”â”â”â”â”â”â”â”â”
ğŸ’ª ÄÆ¡n vá»‹ cÆ°á»ng hÃ³a: ${stats.unitsBuffed}
âš¡ Thá»i gian cháº¡y: ${Math.floor(stats.sessionTime / 1000)}s
ğŸ‘‘ Cáº¥p Ä‘á»™ quyá»n háº¡n: HWANG IMMORTAL
â”â”â”â”â”â”â”â”â”â”
ğŸŒŸ Tiáº¿n Ä‘á»™ tu tiÃªn: ${(stats.unitsBuffed * 10)}%
            `;
            _originalAlert(msg);
        });

        // NÃºt reset
        resetBtn.addEventListener("click", () => {
            if (_originalConfirm("ğŸ”„ Báº¡n cÃ³ cháº¯c muá»‘n Ä‘áº·t láº¡i má»i tráº¡ng thÃ¡i?")) {
                window.__HACK_STATE.stats = {
                    unitsBuffed: 0,
                    totalDamage: 0,
                    sessionTime: 0
                };
                originalStats.clear || (originalStats.constructor = new WeakMap());
                _originalAlert("âœ… Tráº¡ng thÃ¡i Ä‘Ã£ Ä‘Æ°á»£c Ä‘áº·t láº¡i!");
            }
        });

        // NÃºt Ä‘Ã³ng
        closeBtn.addEventListener("click", () => {
            if (_originalConfirm("âš”ï¸ Báº¡n cÃ³ cháº¯c muá»‘n Ä‘Ã³ngã€HoÃ ng HoÃ ng BÃ­ Tá»‹chã€‘?")) {
                if (running) toggleBtn.click();
                panel.remove();
                console.log("âŒ ã€HoÃ ng HoÃ ng BÃ­ Tá»‹chã€‘Ä‘Ã£ Ä‘Ã³ng");
            }
        });

        // NÃºt thu nhá»
        minimizeBtn.addEventListener("click", () => {
            panel.classList.toggle("minimized");
        });

        // Chá»©c nÄƒng kÃ©o tháº£
        titleEl.addEventListener("pointerdown", (e) => {
            isDragging = true;
            const rect = panel.getBoundingClientRect();
            dragOffsetX = e.clientX - rect.left;
            dragOffsetY = e.clientY - rect.top;
            titleEl.style.cursor = "grabbing";
        });

        document.addEventListener("pointermove", (e) => {
            if (!isDragging) return;
            const newX = Math.max(0, e.clientX - dragOffsetX);
            const newY = Math.max(0, e.clientY - dragOffsetY);
            panel.style.left = newX + "px";
            panel.style.bottom = "auto";
            panel.style.top = newY + "px";
        });

        document.addEventListener("pointerup", () => {
            if (isDragging) {
                isDragging = false;
                titleEl.style.cursor = "move";
            }
        });

        // Cáº­p nháº­t thá»‘ng kÃª thá»i gian thá»±c
        statsInterval = setInterval(() => {
            if (running) {
                window.__HACK_STATE.stats.sessionTime += 100;
                const timeEl = document.getElementById("statTime");
                const unitsEl = document.getElementById("statUnits");
                if (timeEl) timeEl.textContent = Math.floor(window.__HACK_STATE.stats.sessionTime / 1000) + "s";
                if (unitsEl) unitsEl.textContent = window.__HACK_STATE.stats.unitsBuffed;
            }
        }, 100);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸš€ Khá»Ÿi Ä‘á»™ng Script
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    waitForRealGui(() => {
        addStyles();
        createMainPanel();
    });

    // DOM Theo dÃµi
    const observer = new MutationObserver(() => {
        if (!document.getElementById("hwangMainPanel") && isRealGui()) {
            console.log("ğŸ”„ ã€Táº£i láº¡i trangã€‘Táº¡o láº¡i menu");
            addStyles();
            createMainPanel();
        }
    });

    observer.observe(document, { childList: true, subtree: true });

    // [Má»šI] ThÃªm trÃ¬nh láº¯ng nghe phÃ­m M
    document.addEventListener('keydown', function(event) {
        // NgÄƒn phÃ­m M hoáº¡t Ä‘á»™ng khi Ä‘ang gÃµ chat/input
        if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA' || event.target.isContentEditable) {
            return;
        }

        // Kiá»ƒm tra phÃ­m M
        if (event.key.toLowerCase() === 'm') {
            const panel = document.getElementById("hwangMainPanel");
            if (panel) {
                panel.classList.toggle('hwang-hidden');
            }
        }
    });


    console.log("%c âœ¨ ã€HoÃ ng HoÃ ng BÃ­ Tá»‹chã€‘Ä‘Ã£ táº£i hoÃ n táº¥t! Sáºµn sÃ ng thá»‘ng trá»‹ trÃ² chÆ¡i chÆ°a?", "color: #FFFFFF; font-weight: bold; font-size: 14px;");
})();
